!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){return e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},e.apply(this,arguments)}function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(e,n,r){return n=f(n),function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}(e,c()?Reflect.construct(n,r||[],f(e).constructor):n.apply(e,r))}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}function u(t){var e="function"==typeof Map?new Map:void 0;return u=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(c())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&h(i,n.prototype),i}(t,arguments,f(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),h(n,t)},u(t)}function c(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(c=function(){return!!t})()}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,y(r.key),r)}}function p(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function y(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,n||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}System.register([],(function(t,i){"use strict";return{execute:function(){var i=t("S",function(t){return t[t.TYPE=3]="TYPE",t[t.LEVEL=12]="LEVEL",t[t.ATTRIBUTE=13]="ATTRIBUTE",t[t.BLOT=14]="BLOT",t[t.INLINE=7]="INLINE",t[t.BLOCK=11]="BLOCK",t[t.BLOCK_BLOT=10]="BLOCK_BLOT",t[t.INLINE_BLOT=6]="INLINE_BLOT",t[t.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",t[t.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",t[t.ANY=15]="ANY",t}(i||{})),o=function(){return p((function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};d(this,t),this.attrName=e,this.keyName=n;var o=i.TYPE&i.ATTRIBUTE;this.scope=null!=r.scope?r.scope&i.LEVEL|o:i.ATTRIBUTE,null!=r.whitelist&&(this.whitelist=r.whitelist)}),[{key:"add",value:function(t,e){return!!this.canAdd(t,e)&&(t.setAttribute(this.keyName,e),!0)}},{key:"canAdd",value:function(t,e){return null==this.whitelist||("string"==typeof e?this.whitelist.indexOf(e.replace(/["']/g,""))>-1:this.whitelist.indexOf(e)>-1)}},{key:"remove",value:function(t){t.removeAttribute(this.keyName)}},{key:"value",value:function(t){var e=t.getAttribute(this.keyName);return this.canAdd(t,e)&&e?e:""}}],[{key:"keys",value:function(t){return Array.from(t.attributes).map((function(t){return t.name}))}}])}();t("c",o);var c=function(t){function e(t){var n;return d(this,e),(n=a(this,e,[t="[Parchment] "+t])).message=t,n.name=n.constructor.name,n}return l(e,t),p(e)}(u(Error)),h=function(){function t(){d(this,t),this.attributes={},this.classes={},this.tags={},this.types={}}return p(t,[{key:"create",value:function(e,n,r){var i=this.query(n);if(null==i)throw new c("Unable to create ".concat(n," blot"));var o=i,a=n instanceof Node||n.nodeType===Node.TEXT_NODE?n:o.create(r),s=new o(e,a,r);return t.blots.set(s.domNode,s),s}},{key:"find",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.find(e,n)}},{key:"query",value:function(t){var e,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.ANY;return"string"==typeof t?e=this.types[t]||this.attributes[t]:t instanceof Text||t.nodeType===Node.TEXT_NODE?e=this.types.text:"number"==typeof t?t&i.LEVEL&i.BLOCK?e=this.types.block:t&i.LEVEL&i.INLINE&&(e=this.types.inline):t instanceof Element&&((t.getAttribute("class")||"").split(/\s+/).some((function(t){return!!(e=n.classes[t])})),e=e||this.tags[t.tagName]),null==e?null:"scope"in e&&r&i.LEVEL&e.scope&&r&i.TYPE&e.scope?e:null}},{key:"register",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.map((function(e){var n="blotName"in e,r="attrName"in e;if(!n&&!r)throw new c("Invalid definition");if(n&&"abstract"===e.blotName)throw new c("Cannot register abstract class");var i=n?e.blotName:r?e.attrName:void 0;return t.types[i]=e,r?"string"==typeof e.keyName&&(t.attributes[e.keyName]=e):n&&(e.className&&(t.classes[e.className]=e),e.tagName&&(Array.isArray(e.tagName)?e.tagName=e.tagName.map((function(t){return t.toUpperCase()})):e.tagName=e.tagName.toUpperCase(),(Array.isArray(e.tagName)?e.tagName:[e.tagName]).forEach((function(n){(null==t.tags[n]||null==e.className)&&(t.tags[n]=e)})))),e}))}}],[{key:"find",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==t)return null;if(this.blots.has(t))return this.blots.get(t)||null;if(e){var n=null;try{n=t.parentNode}catch(r){return null}return this.find(n,e)}return null}}])}();h.blots=new WeakMap;var v=t("R",h);function m(t,e){return(t.getAttribute("class")||"").split(/\s+/).filter((function(t){return 0===t.indexOf("".concat(e,"-"))}))}var N=function(t){function e(){return d(this,e),a(this,e,arguments)}return l(e,t),p(e,[{key:"add",value:function(t,e){return!!this.canAdd(t,e)&&(this.remove(t),t.classList.add("".concat(this.keyName,"-").concat(e)),!0)}},{key:"remove",value:function(t){m(t,this.keyName).forEach((function(e){t.classList.remove(e)})),0===t.classList.length&&t.removeAttribute("class")}},{key:"value",value:function(t){var e=(m(t,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(t,e)?e:""}}],[{key:"keys",value:function(t){return(t.getAttribute("class")||"").split(/\s+/).map((function(t){return t.split("-").slice(0,-1).join("-")}))}}])}(o),b=t("d",N);function k(t){var e=t.split("-"),n=e.slice(1).map((function(t){return t[0].toUpperCase()+t.slice(1)})).join("");return e[0]+n}var g=function(t){function e(){return d(this,e),a(this,e,arguments)}return l(e,t),p(e,[{key:"add",value:function(t,e){return!!this.canAdd(t,e)&&(t.style[k(this.keyName)]=e,!0)}},{key:"remove",value:function(t){t.style[k(this.keyName)]="",t.getAttribute("style")||t.removeAttribute("style")}},{key:"value",value:function(t){var e=t.style[k(this.keyName)];return this.canAdd(t,e)?e:""}}],[{key:"keys",value:function(t){return(t.getAttribute("style")||"").split(";").map((function(t){return t.split(":")[0].trim()}))}}])}(o),A=t("e",g),E=t("A",function(){return p((function t(e){d(this,t),this.attributes={},this.domNode=e,this.build()}),[{key:"attribute",value:function(t,e){e?t.add(this.domNode,e)&&(null!=t.value(this.domNode)?this.attributes[t.attrName]=t:delete this.attributes[t.attrName]):(t.remove(this.domNode),delete this.attributes[t.attrName])}},{key:"build",value:function(){var t=this;this.attributes={};var e=v.find(this.domNode);if(null!=e){var n=o.keys(this.domNode),r=b.keys(this.domNode),a=A.keys(this.domNode);n.concat(r).concat(a).forEach((function(n){var r=e.scroll.query(n,i.ATTRIBUTE);r instanceof o&&(t.attributes[r.attrName]=r)}))}}},{key:"copy",value:function(t){var e=this;Object.keys(this.attributes).forEach((function(n){var r=e.attributes[n].value(e.domNode);t.format(n,r)}))}},{key:"move",value:function(t){var e=this;this.copy(t),Object.keys(this.attributes).forEach((function(t){e.attributes[t].remove(e.domNode)})),this.attributes={}}},{key:"values",value:function(){var t=this;return Object.keys(this.attributes).reduce((function(e,n){return e[n]=t.attributes[n].value(t.domNode),e}),{})}}])}()),w=function(){return p((function t(e,n){d(this,t),this.scroll=e,this.domNode=n,v.blots.set(n,this),this.prev=null,this.next=null}),[{key:"statics",get:function(){return this.constructor}},{key:"attach",value:function(){}},{key:"clone",value:function(){var t=this.domNode.cloneNode(!1);return this.scroll.create(t)}},{key:"detach",value:function(){null!=this.parent&&this.parent.removeChild(this),v.blots.delete(this.domNode)}},{key:"deleteAt",value:function(t,e){this.isolate(t,e).remove()}},{key:"formatAt",value:function(t,e,n,r){var o=this.isolate(t,e);if(null!=this.scroll.query(n,i.BLOT)&&r)o.wrap(n,r);else if(null!=this.scroll.query(n,i.ATTRIBUTE)){var a=this.scroll.create(this.statics.scope);o.wrap(a),a.format(n,r)}}},{key:"insertAt",value:function(t,e,n){var r=null==n?this.scroll.create("text",e):this.scroll.create(e,n),i=this.split(t);this.parent.insertBefore(r,i||void 0)}},{key:"isolate",value:function(t,e){var n=this.split(t);if(null==n)throw new Error("Attempt to isolate at end");return n.split(e),n}},{key:"length",value:function(){return 1}},{key:"offset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;return null==this.parent||this===t?0:this.parent.children.offset(this)+this.parent.offset(t)}},{key:"optimize",value:function(t){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}},{key:"remove",value:function(){null!=this.domNode.parentNode&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}},{key:"replaceWith",value:function(t,e){var n="string"==typeof t?this.scroll.create(t,e):t;return null!=this.parent&&(this.parent.insertBefore(n,this.next||void 0),this.remove()),n}},{key:"split",value:function(t,e){return 0===t?this:this.next}},{key:"update",value:function(t,e){}},{key:"wrap",value:function(t,e){var n="string"==typeof t?this.scroll.create(t,e):t;if(null!=this.parent&&this.parent.insertBefore(n,this.next||void 0),"function"!=typeof n.appendChild)throw new c("Cannot wrap ".concat(t));return n.appendChild(this),n}}],[{key:"create",value:function(t){if(null==this.tagName)throw new c("Blot definition missing tagName");var e,n;return Array.isArray(this.tagName)?("string"==typeof t?(n=t.toUpperCase(),parseInt(n,10).toString()===n&&(n=parseInt(n,10))):"number"==typeof t&&(n=t),e="number"==typeof n?document.createElement(this.tagName[n-1]):n&&this.tagName.indexOf(n)>-1?document.createElement(n):document.createElement(this.tagName[0])):e=document.createElement(this.tagName),this.className&&e.classList.add(this.className),e}}])}();w.blotName="abstract";var O=w,T=function(t){function e(){return d(this,e),a(this,e,arguments)}return l(e,t),p(e,[{key:"index",value:function(t,e){return this.domNode===t||this.domNode.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(e,1):-1}},{key:"position",value:function(t,e){var n=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return t>0&&(n+=1),[this.parent.domNode,n]}},{key:"value",value:function(){return function(t,e,n){return(e=y(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},this.statics.blotName,this.statics.value(this.domNode)||!0)}}],[{key:"value",value:function(t){return!0}}])}(O);T.scope=i.INLINE_BLOT;var x=t("L",T),B=function(){return p((function t(){d(this,t),this.head=null,this.tail=null,this.length=0}),[{key:"append",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(this.insertBefore(e[0],null),e.length>1){var i=e.slice(1);this.append.apply(this,r(i))}}},{key:"at",value:function(t){for(var e=this.iterator(),n=e();n&&t>0;)t-=1,n=e();return n}},{key:"contains",value:function(t){for(var e=this.iterator(),n=e();n;){if(n===t)return!0;n=e()}return!1}},{key:"indexOf",value:function(t){for(var e=this.iterator(),n=e(),r=0;n;){if(n===t)return r;r+=1,n=e()}return-1}},{key:"insertBefore",value:function(t,e){null!=t&&(this.remove(t),t.next=e,null!=e?(t.prev=e.prev,null!=e.prev&&(e.prev.next=t),e.prev=t,e===this.head&&(this.head=t)):null!=this.tail?(this.tail.next=t,t.prev=this.tail,this.tail=t):(t.prev=null,this.head=this.tail=t),this.length+=1)}},{key:"offset",value:function(t){for(var e=0,n=this.head;null!=n;){if(n===t)return e;e+=n.length(),n=n.next}return-1}},{key:"remove",value:function(t){this.contains(t)&&(null!=t.prev&&(t.prev.next=t.next),null!=t.next&&(t.next.prev=t.prev),t===this.head&&(this.head=t.next),t===this.tail&&(this.tail=t.prev),this.length-=1)}},{key:"iterator",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.head;return function(){var e=t;return null!=t&&(t=t.next),e}}},{key:"find",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.iterator(),r=n();r;){var i=r.length();if(t<i||e&&t===i&&(null==r.next||0!==r.next.length()))return[r,t];t-=i,r=n()}return[null,0]}},{key:"forEach",value:function(t){for(var e=this.iterator(),n=e();n;)t(n),n=e()}},{key:"forEachAt",value:function(t,e,r){if(!(e<=0))for(var i=n(this.find(t),2),o=i[0],a=t-i[1],s=this.iterator(o),l=s();l&&a<t+e;){var u=l.length();t>a?r(l,t-a,Math.min(e,a+u-t)):r(l,0,Math.min(u,t+e-a)),a+=u,l=s()}}},{key:"map",value:function(t){return this.reduce((function(e,n){return e.push(t(n)),e}),[])}},{key:"reduce",value:function(t,e){for(var n=this.iterator(),r=n();r;)e=t(e,r),r=n();return e}}])}();function C(t,e){var n=e.find(t);if(n)return n;try{return e.create(t)}catch(o){var r=e.create(i.INLINE);return Array.from(t.childNodes).forEach((function(t){r.domNode.appendChild(t)})),t.parentNode&&t.parentNode.replaceChild(r.domNode,t),r.attach(),r}}var L=function(t){function o(t,e){var n;return d(this,o),(n=a(this,o,[t,e])).uiNode=null,n.build(),n}return l(o,t),p(o,[{key:"appendChild",value:function(t){this.insertBefore(t)}},{key:"attach",value:function(){e(f(o.prototype),"attach",this).call(this),this.children.forEach((function(t){t.attach()}))}},{key:"attachUI",value:function(t){null!=this.uiNode&&this.uiNode.remove(),this.uiNode=t,o.uiClass&&this.uiNode.classList.add(o.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}},{key:"build",value:function(){var t=this;this.children=new B,Array.from(this.domNode.childNodes).filter((function(e){return e!==t.uiNode})).reverse().forEach((function(e){try{var n=C(e,t.scroll);t.insertBefore(n,t.children.head||void 0)}catch(r){if(r instanceof c)return;throw r}}))}},{key:"deleteAt",value:function(t,e){if(0===t&&e===this.length())return this.remove();this.children.forEachAt(t,e,(function(t,e,n){t.deleteAt(e,n)}))}},{key:"descendant",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=n(this.children.find(e),2),i=r[0],a=r[1];return null==t.blotName&&t(i)||null!=t.blotName&&i instanceof t?[i,a]:i instanceof o?i.descendant(t,a):[null,-1]}},{key:"descendants",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,r=[],i=n;return this.children.forEachAt(e,n,(function(e,n,a){(null==t.blotName&&t(e)||null!=t.blotName&&e instanceof t)&&r.push(e),e instanceof o&&(r=r.concat(e.descendants(t,n,i))),i-=a})),r}},{key:"detach",value:function(){this.children.forEach((function(t){t.detach()})),e(f(o.prototype),"detach",this).call(this)}},{key:"enforceAllowedChildren",value:function(){var t=this,e=!1;this.children.forEach((function(n){e||t.statics.allowedChildren.some((function(t){return n instanceof t}))||(n.statics.scope===i.BLOCK_BLOT?(null!=n.next&&t.splitAfter(n),null!=n.prev&&t.splitAfter(n.prev),n.parent.unwrap(),e=!0):n instanceof o?n.unwrap():n.remove())}))}},{key:"formatAt",value:function(t,e,n,r){this.children.forEachAt(t,e,(function(t,e,i){t.formatAt(e,i,n,r)}))}},{key:"insertAt",value:function(t,e,r){var i=n(this.children.find(t),2),o=i[0],a=i[1];if(o)o.insertAt(a,e,r);else{var s=null==r?this.scroll.create("text",e):this.scroll.create(e,r);this.appendChild(s)}}},{key:"insertBefore",value:function(t,e){null!=t.parent&&t.parent.children.remove(t);var n=null;this.children.insertBefore(t,e||null),t.parent=this,null!=e&&(n=e.domNode),(this.domNode.parentNode!==t.domNode||this.domNode.nextSibling!==n)&&this.domNode.insertBefore(t.domNode,n),t.attach()}},{key:"length",value:function(){return this.children.reduce((function(t,e){return t+e.length()}),0)}},{key:"moveChildren",value:function(t,e){this.children.forEach((function(n){t.insertBefore(n,e)}))}},{key:"optimize",value:function(t){if(e(f(o.prototype),"optimize",this).call(this,t),this.enforceAllowedChildren(),null!=this.uiNode&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),0===this.children.length)if(null!=this.statics.defaultChild){var n=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(n)}else this.remove()}},{key:"path",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n(this.children.find(t,e),2),i=r[0],a=r[1],s=[[this,t]];return i instanceof o?s.concat(i.path(a,e)):(null!=i&&s.push([i,a]),s)}},{key:"removeChild",value:function(t){this.children.remove(t)}},{key:"replaceWith",value:function(t,n){var r="string"==typeof t?this.scroll.create(t,n):t;return r instanceof o&&this.moveChildren(r),e(f(o.prototype),"replaceWith",this).call(this,r)}},{key:"split",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e){if(0===t)return this;if(t===this.length())return this.next}var n=this.clone();return this.parent&&this.parent.insertBefore(n,this.next||void 0),this.children.forEachAt(t,this.length(),(function(t,r,i){var o=t.split(r,e);null!=o&&n.appendChild(o)})),n}},{key:"splitAfter",value:function(t){for(var e=this.clone();null!=t.next;)e.appendChild(t.next);return this.parent&&this.parent.insertBefore(e,this.next||void 0),e}},{key:"unwrap",value:function(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}},{key:"update",value:function(t,e){var n=this,i=[],o=[];t.forEach((function(t){t.target===n.domNode&&"childList"===t.type&&(i.push.apply(i,r(t.addedNodes)),o.push.apply(o,r(t.removedNodes)))})),o.forEach((function(t){if(!(null!=t.parentNode&&"IFRAME"!==t.tagName&&document.body.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var e=n.scroll.find(t);null!=e&&(null==e.domNode.parentNode||e.domNode.parentNode===n.domNode)&&e.detach()}})),i.filter((function(t){return t.parentNode===n.domNode&&t!==n.uiNode})).sort((function(t,e){return t===e?0:t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1})).forEach((function(t){var e=null;null!=t.nextSibling&&(e=n.scroll.find(t.nextSibling));var r=C(t,n.scroll);(r.next!==e||null==r.next)&&(null!=r.parent&&r.parent.removeChild(n),n.insertBefore(r,e||void 0))})),this.enforceAllowedChildren()}}])}(O);L.uiClass="";var I=t("P",L);var _=function(t){function n(t,e){var r;return d(this,n),(r=a(this,n,[t,e])).attributes=new E(r.domNode),r}return l(n,t),p(n,[{key:"format",value:function(t,e){var r=this;if(t!==this.statics.blotName||e){var a=this.scroll.query(t,i.INLINE);if(null==a)return;a instanceof o?this.attributes.attribute(a,e):e&&(t!==this.statics.blotName||this.formats()[t]!==e)&&this.replaceWith(t,e)}else this.children.forEach((function(t){t instanceof n||(t=t.wrap(n.blotName,!0)),r.attributes.copy(t)})),this.unwrap()}},{key:"formats",value:function(){var t=this.attributes.values(),e=this.statics.formats(this.domNode,this.scroll);return null!=e&&(t[this.statics.blotName]=e),t}},{key:"formatAt",value:function(t,r,o,a){null!=this.formats()[o]||this.scroll.query(o,i.ATTRIBUTE)?this.isolate(t,r).format(o,a):e(f(n.prototype),"formatAt",this).call(this,t,r,o,a)}},{key:"optimize",value:function(t){e(f(n.prototype),"optimize",this).call(this,t);var r=this.formats();if(0===Object.keys(r).length)return this.unwrap();var i=this.next;i instanceof n&&i.prev===this&&function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(t[n]!==e[n])return!1;return!0}(r,i.formats())&&(i.moveChildren(this),i.remove())}},{key:"replaceWith",value:function(t,r){var i=e(f(n.prototype),"replaceWith",this).call(this,t,r);return this.attributes.copy(i),i}},{key:"update",value:function(t,r){var i=this;e(f(n.prototype),"update",this).call(this,t,r),t.some((function(t){return t.target===i.domNode&&"attributes"===t.type}))&&this.attributes.build()}},{key:"wrap",value:function(t,r){var i=e(f(n.prototype),"wrap",this).call(this,t,r);return i instanceof n&&this.attributes.move(i),i}}],[{key:"create",value:function(t){return e(f(n),"create",this).call(this,t)}},{key:"formats",value:function(t,e){var r=e.query(n.blotName);if(null==r||t.tagName!==r.tagName){if("string"==typeof this.tagName)return!0;if(Array.isArray(this.tagName))return t.tagName.toLowerCase()}}}])}(I);_.allowedChildren=[_,x],_.blotName="inline",_.scope=i.INLINE_BLOT,_.tagName="SPAN";var S=t("I",_),j=function(t){function n(t,e){var r;return d(this,n),(r=a(this,n,[t,e])).attributes=new E(r.domNode),r}return l(n,t),p(n,[{key:"format",value:function(t,e){var r=this.scroll.query(t,i.BLOCK);null!=r&&(r instanceof o?this.attributes.attribute(r,e):t!==this.statics.blotName||e?e&&(t!==this.statics.blotName||this.formats()[t]!==e)&&this.replaceWith(t,e):this.replaceWith(n.blotName))}},{key:"formats",value:function(){var t=this.attributes.values(),e=this.statics.formats(this.domNode,this.scroll);return null!=e&&(t[this.statics.blotName]=e),t}},{key:"formatAt",value:function(t,r,o,a){null!=this.scroll.query(o,i.BLOCK)?this.format(o,a):e(f(n.prototype),"formatAt",this).call(this,t,r,o,a)}},{key:"insertAt",value:function(t,r,o){if(null==o||null!=this.scroll.query(r,i.INLINE))e(f(n.prototype),"insertAt",this).call(this,t,r,o);else{var a=this.split(t);if(null==a)throw new Error("Attempt to insertAt after block boundaries");var s=this.scroll.create(r,o);a.parent.insertBefore(s,a)}}},{key:"replaceWith",value:function(t,r){var i=e(f(n.prototype),"replaceWith",this).call(this,t,r);return this.attributes.copy(i),i}},{key:"update",value:function(t,r){var i=this;e(f(n.prototype),"update",this).call(this,t,r),t.some((function(t){return t.target===i.domNode&&"attributes"===t.type}))&&this.attributes.build()}}],[{key:"create",value:function(t){return e(f(n),"create",this).call(this,t)}},{key:"formats",value:function(t,e){var r=e.query(n.blotName);if(null==r||t.tagName!==r.tagName){if("string"==typeof this.tagName)return!0;if(Array.isArray(this.tagName))return t.tagName.toLowerCase()}}}])}(I);j.blotName="block",j.scope=i.BLOCK_BLOT,j.tagName="P",j.allowedChildren=[S,j,x];var P=t("B",j),R=function(t){function n(){return d(this,n),a(this,n,arguments)}return l(n,t),p(n,[{key:"checkMerge",value:function(){return null!==this.next&&this.next.statics.blotName===this.statics.blotName}},{key:"deleteAt",value:function(t,r){e(f(n.prototype),"deleteAt",this).call(this,t,r),this.enforceAllowedChildren()}},{key:"formatAt",value:function(t,r,i,o){e(f(n.prototype),"formatAt",this).call(this,t,r,i,o),this.enforceAllowedChildren()}},{key:"insertAt",value:function(t,r,i){e(f(n.prototype),"insertAt",this).call(this,t,r,i),this.enforceAllowedChildren()}},{key:"optimize",value:function(t){e(f(n.prototype),"optimize",this).call(this,t),this.children.length>0&&null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}}])}(I);R.blotName="container",R.scope=i.BLOCK_BLOT;var U=t("C",R),M=function(t){function n(){return d(this,n),a(this,n,arguments)}return l(n,t),p(n,[{key:"format",value:function(t,r){e(f(n.prototype),"formatAt",this).call(this,0,this.length(),t,r)}},{key:"formatAt",value:function(t,r,i,o){0===t&&r===this.length()?this.format(i,o):e(f(n.prototype),"formatAt",this).call(this,t,r,i,o)}},{key:"formats",value:function(){return this.statics.formats(this.domNode,this.scroll)}}],[{key:"formats",value:function(t,e){}}])}(x),q=t("E",M),D={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},z=function(t){function n(t,e){var r;return d(this,n),(r=a(this,n,[null,e])).registry=t,r.scroll=s(r),r.build(),r.observer=new MutationObserver((function(t){r.update(t)})),r.observer.observe(r.domNode,D),r.attach(),r}return l(n,t),p(n,[{key:"create",value:function(t,e){return this.registry.create(this,t,e)}},{key:"find",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.registry.find(t,e);return n?n.scroll===this?n:e?this.find(n.scroll.domNode.parentNode,!0):null:null}},{key:"query",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.ANY;return this.registry.query(t,e)}},{key:"register",value:function(){var t;return(t=this.registry).register.apply(t,arguments)}},{key:"build",value:function(){null!=this.scroll&&e(f(n.prototype),"build",this).call(this)}},{key:"detach",value:function(){e(f(n.prototype),"detach",this).call(this),this.observer.disconnect()}},{key:"deleteAt",value:function(t,r){this.update(),0===t&&r===this.length()?this.children.forEach((function(t){t.remove()})):e(f(n.prototype),"deleteAt",this).call(this,t,r)}},{key:"formatAt",value:function(t,r,i,o){this.update(),e(f(n.prototype),"formatAt",this).call(this,t,r,i,o)}},{key:"insertAt",value:function(t,r,i){this.update(),e(f(n.prototype),"insertAt",this).call(this,t,r,i)}},{key:"optimize",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(f(n.prototype),"optimize",this).call(this,i);for(var o=i.mutationsMap||new WeakMap,a=Array.from(this.observer.takeRecords());a.length>0;)r.push(a.pop());for(var s=function e(n){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null==n||n===t||null!=n.domNode.parentNode&&(o.has(n.domNode)||o.set(n.domNode,[]),r&&e(n.parent))},l=function t(e){o.has(e.domNode)&&(e instanceof I&&e.children.forEach(t),o.delete(e.domNode),e.optimize(i))},u=r,c=0;u.length>0;c+=1){if(c>=100)throw new Error("[Parchment] Maximum optimize iterations reached");for(u.forEach((function(e){var n=t.find(e.target,!0);null!=n&&(n.domNode===e.target&&("childList"===e.type?(s(t.find(e.previousSibling,!1)),Array.from(e.addedNodes).forEach((function(e){var n=t.find(e,!1);s(n,!1),n instanceof I&&n.children.forEach((function(t){s(t,!1)}))}))):"attributes"===e.type&&s(n.prev)),s(n))})),this.children.forEach(l),a=(u=Array.from(this.observer.takeRecords())).slice();a.length>0;)r.push(a.pop())}}},{key:"update",value:function(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=t||this.observer.takeRecords();var o=new WeakMap;t.map((function(t){var e=r.find(t.target,!0);return null==e?null:o.has(e.domNode)?(o.get(e.domNode).push(t),null):(o.set(e.domNode,[t]),e)})).forEach((function(t){null!=t&&t!==r&&o.has(t.domNode)&&t.update(o.get(t.domNode)||[],i)})),i.mutationsMap=o,o.has(this.domNode)&&e(f(n.prototype),"update",this).call(this,o.get(this.domNode),i),this.optimize(t,i)}}])}(I);z.blotName="scroll",z.defaultChild=P,z.allowedChildren=[P,U],z.scope=i.BLOCK_BLOT,z.tagName="DIV";var W=t("b",z),K=function(t){function n(t,e){var r;return d(this,n),(r=a(this,n,[t,e])).text=r.statics.value(r.domNode),r}return l(n,t),p(n,[{key:"deleteAt",value:function(t,e){this.domNode.data=this.text=this.text.slice(0,t)+this.text.slice(t+e)}},{key:"index",value:function(t,e){return this.domNode===t?e:-1}},{key:"insertAt",value:function(t,r,i){null==i?(this.text=this.text.slice(0,t)+r+this.text.slice(t),this.domNode.data=this.text):e(f(n.prototype),"insertAt",this).call(this,t,r,i)}},{key:"length",value:function(){return this.text.length}},{key:"optimize",value:function(t){e(f(n.prototype),"optimize",this).call(this,t),this.text=this.statics.value(this.domNode),0===this.text.length?this.remove():this.next instanceof n&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}},{key:"position",value:function(t){return[this.domNode,t]}},{key:"split",value:function(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){if(0===t)return this;if(t===this.length())return this.next}var e=this.scroll.create(this.domNode.splitText(t));return this.parent.insertBefore(e,this.next||void 0),this.text=this.statics.value(this.domNode),e}},{key:"update",value:function(t,e){var n=this;t.some((function(t){return"characterData"===t.type&&t.target===n.domNode}))&&(this.text=this.statics.value(this.domNode))}},{key:"value",value:function(){return this.text}}],[{key:"create",value:function(t){return document.createTextNode(t)}},{key:"value",value:function(t){return t.data}}])}(x);K.blotName="text",K.scope=i.INLINE_BLOT;var Y=t("T",K),V=Object.freeze(Object.defineProperty({__proto__:null,Attributor:o,AttributorStore:E,BlockBlot:P,ClassAttributor:b,ContainerBlot:U,EmbedBlot:q,InlineBlot:S,LeafBlot:x,ParentBlot:I,Registry:v,Scope:i,ScrollBlot:W,StyleAttributor:A,TextBlot:Y},Symbol.toStringTag,{value:"Module"}));t("a",V)}}}))}();
//# sourceMappingURL=parchment-legacy-DCraDLkV.js.map
